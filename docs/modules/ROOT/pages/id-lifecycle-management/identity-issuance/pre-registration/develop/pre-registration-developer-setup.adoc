== Developers Guide

=== Overview

The documentation here will guide you through the pre-requisites
required for
https://docs.mosip.io/1.2.0/modules/pre-registration[Pre-registration]
developer setup.

=== Software setup

===== Below are the list of tools required in Pre-registration

[arabic]
. JDK 11
. Any IDE (Eclipse, IntelliJ IDEA)
. Apache Maven (zip folder)
. pgAdmin
. Postman
. Git
. https://projectlombok.org/download[lombok.jar] (file)
. MOSIP Pre-registration specific JARs: The version will depend on which
Pre Registration branch you have cloned. If it is "`release-1.2.0.1`"
then you can download 1.2.0.1.B1 or 1.2.0.1.B2 version of below jars
whichever is available.
* https://repo1.maven.org/maven2/io/mosip/kernel/kernel-auth-adapter/[kernel-auth-adapter]
* https://repo1.maven.org/maven2/io/mosip/kernel/kernel-transliteration-icu4j/[kernel-transliteration-icu4j]
* https://repo1.maven.org/maven2/io/mosip/kernel/kernel-ref-idobjectvalidator/[kernel-ref-idobjectvalidator]
* https://repo1.maven.org/maven2/io/mosip/kernel/kernel-virusscanner-clamav/[kernel-virusscanner-clamav]
. link:../../../../_files/pre-registration-config-files/settings.xml[settings.xml]
. Notepad{plus}{plus} (optional)

===== Follow the steps below to setup Pre-registration on your local system

[arabic]
. Fork the MOSIP
https://github.com/mosip/pre-registration[Pre-registration repository]
from Github MOSIP repository to your GitHub account.
. Clone the forked repository into your local machine.
* `git clone https://github.com/$++{++urgithubaccname}/pre-registration.git`
* `git remote add upstream https://github.com/mosip/pre-registration.git`
* `git remote set-url --push upstream no++_++push`
* `git remote -v`
* `git checkout -b my-release-1.2.0.1`
* `git fetch upstream`
* `git rebase upstream/release-1.2.0.1`
. Inside `settings.xml` change local repository directory to your
directory name where `.m2 folder` is located. E.g.:
`++<++localRepository++>++C:/Users/username/.m2/repository++<++/localRepository++>++`
. Add `settings.xml` inside `.m2 folder` (Maven Folder). E.g.:
`C:++\++Users++\++username++\++.m2`
. Import the project in Eclipse IDE and it starts updating Maven
projects configuration, refreshing workspaces, project starts building
(downloading sources, javadoc).
. Add downloaded `lombok.jar` to project, click on downloaded JAR and
install specifying Eclipse IDE(eclipse.exe) location.

image:../../../../.gitbook/assets/lombok-configuration.png[../../../../.gitbook/assets/lombok-configuration]

[arabic, start=7]
. Configure the JDK (Standard VM) with your Eclipse by traversing
through `Preferences → Java → Installed JREs`.

image:../../../../.gitbook/assets/installed-jre.png[../../../../.gitbook/assets/installed-jre]

[arabic, start=8]
. Add MOSIP Pre-registration specific JARs from
https://repo1.maven.org/maven2/io/mosip/[Maven central]:
* Adding JARs to Build Path: Right click on service -++>++ Build Path
-++>++ Configure Build Path -++>++ click on Classpath -++>++ Add
External JARs -++>++ Add required JARs -++>++ Apply and close.

image:../../../../.gitbook/assets/add-external-library.png[../../../../.gitbook/assets/add-external-library]

[arabic, start=9]
. Add `auth-adapter`, `transliteration`, `ref-idobjectvalidator`,
`virusscanner`, `lombok` JARs to `pre-registration-application-service`,
`pre-registration-datasync-service` classpath.
. Add `auth-adapter`, `lombok` JARs to `pre-registration-core`,
`pre-registration-batchjob`, `pre-registration-captcha-service`,
`pre-registration-booking-service` classpath.
. Run `mvn clean install -Dgpg.skip=true` command to build locally and
to execute test cases.
. Update Maven dependencies: Maven syncs the Eclipse project settings
with that of the pom. It downloads dependencies required for the
project.
. Build and run the Project.
. To run the pre-registration-application-service locally *_without
config server_*, update values in application.properties and
bootstrap.properties:

* `spring.cloud.config.uri=https://localhost:8080`
* `spring.cloud.config.label=develop`
* `spring.cloud.config.name=pre-registration`
* `spring.application.name=pre-registration-application-service`
* `spring.profiles.active=default` *_Point below urls to a valid env
which has MOSIP setup:_*
* `mosip.base.url=https://yourenvurl`
* `auth-token-generator.rest.issuerUrl:https://iam.yourenvurl/auth/realms/mosip`
* `javax.persistence.jdbc.password: XXXXXX`
* `javax.persistence.jdbc.url=jdbc:postgresql://yourenvurl:5432/mosip++_++prereg`
* `mosip.batch.token.authmanager.password: XXXXXX`
* `mosip.iam.adapter.appid=prereg`
* `mosip.iam.adapter.clientsecret=XXXXXX`
* `auth.server.admin.issuer.uri=https://iam.yourenvurl/auth/realms/`

=== Developer setup for MOSIP Pre-registration UI

[arabic]
. Fork the https://github.com/mosip/pre-registration-ui[Pre-registration
UI repo] to your GitHub account.
. Clone the forked repository into your local machine.

* `git clone https://github.com/$++{++urgithubaccname}/pre-registration-ui.git`
* `git remote add upstream https://github.com/mosip/pre-registration-ui.git`
* `git remote set-url --push upstream no++_++push`
* `git remote -v`
* `git checkout -b my-release-1.2.0.1`
* `git fetch upstream`
* `git rebase upstream/release-1.2.0.1`

[arabic, start=3]
. Install all dependencies with `npm install`.
. Install Angular JS `npm install -g @angular/cli`.
. Start the Angular JS server `ng serve`.
. Open `http://localhost:4200` to access the application.
. You will face CORS issue since API Services are hosted on
`https://++{++env}`.

===== Using the Angular CLI proxy solution to get around CORS issue

[arabic]
. Update the API services `BASE++_++URL` in `config.json`:
* `config.json` is found inside assets directory.
* E.g.:
`C:++\++MOSIP++\++pre-registration-ui++\++pre-registration-ui++\++src++\++assets++\++config.json`
+
....
{
"BASE_URL": "https://localhost:4200/proxyapi/",
"PRE_REG_URL": "preregistration/v1/"
}
....
. Create a new file named `proxy.conf.json`:
+
Location should be in
`C:++\++MOSIP++\++pre-registration-ui++\++pre-registration-ui++\++proxy.conf.json`
project folder.
+
....
{
 "/proxyapi": {
  "target": "https://{env}/",
  "secure": true,
  "changeOrigin": true,
  "pathRewrite": {
    "^/proxyapi": ""
      }
    }
  }
....
. Start the server by executing
`ng serve --proxy-config proxy.conf.json --ssl true`.
. Open the browser, load the app with `https://localhost:4200`.

=== Pre-registration API

[arabic]
. For API documentation, refer
https://mosip.github.io/documentation/1.2.0/1.2.0.html[here].
. The APIs can be tested with the help of *Swagger-UI* and *Postman*.
. Swagger is an interface description language for describing restful
APIs expressed using JSON. You can access Swagger-UI of pre-registration
here:
* Pre-registration Application service :
`https://++{++env}/preregistration/v1/application-service/swagger-ui.html`
* Pre-registration Datasync Service :
`https://++{++env}/preregistration/v1/sync/datasync-service/swagger-ui.html`
* Pre-registration Captcha service :
`https://++{++env}/preregistration/v1/captcha/swagger-ui.html`
* Pre-registration Booking service :
`https://++{++env}/preregistration/v1/appointment/booking-service/swagger-ui.html`
